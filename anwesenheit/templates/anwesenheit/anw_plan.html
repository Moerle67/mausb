{% extends "stammdaten/base.html" %}

{% block title %}Sitzplan{% endblock title %}

{% block content_fluid %}
<div class="row">
    {% comment %} Sitzplan {% endcomment %}
    <div class="col-9">
        <h1>Sitzplan Raum {{raum}}</h1>
        {% for reihe in elements %}
            <div class="row border">
            {% for spalte in reihe %}
                {% if raum.gang == forloop.counter %} 
                    <div class="col shadow rounded-pill "></div>
                {% endif %}
                <div id="sitz{{forloop.parentloop.counter0}}_{{forloop.counter0}}" class="col border shadow m-3 text-center rounded-pill bg-light bg-opacity-75"
                 ondrop="dropHandler(event, {{forloop.counter0}}, {{forloop.parentloop.counter0}}, {{raum.id}})" ondragover="dragoverHandler(event)">
                    {{spalte}}
                </div>
            {% endfor %}    
            </div>   
        {% endfor %}
    </div>

    {% comment %} Leiste Teilnehmer {% endcomment %}
    <div class="col-2">
        {% for tn in teilnehmer %}
        <div id="{{tn.id}}" class="border col m-2 shadow" draggable="true" ondragstart="dragstartHandler(event)">{{tn}}</div>
        {% endfor %}
    </div>
</div>
<script>
function dragstartHandler(ev) {
  ev.dataTransfer.setData("text", ev.target.id);
}

function dragoverHandler(ev) {
  ev.preventDefault();
}

function dropHandler(ev, spalte, zeile, raum) {
    ev.preventDefault();
    const teilnehmer = ev.dataTransfer.getData("text");
    // console.log(teilnehmer, zeile, spalte, raum);
    // Backend Save data
    $.ajax({
        type: "POST",
        url: "{% url 'anw:saveplan' %}",
        data: {
            raum: raum,
            zeile: zeile,
            spalte: spalte,
            teilnehmer: teilnehmer,
            csrfmiddlewaretoken: '{{ csrf_token }}'
        },
        success: function(data) {
            
            // Change Sitz
            console.log(teilnehmer);
            $('#sitz'+zeile+'_'+spalte).text(data['teilnehmer']);
        }
    });
  // Remove TN  

}
</script>
{% endblock content_fluid %}